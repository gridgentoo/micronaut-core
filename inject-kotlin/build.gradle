plugins {
    id "io.micronaut.build.internal.convention-library"
    id "org.jetbrains.kotlin.jvm"
    id "com.google.devtools.ksp" version "1.6.10-1.0.2"

}

micronautBuild {
    core {
        usesMicronautTest()
    }
}

dependencies {
    api project(":core-processor")

    implementation("com.google.devtools.ksp:symbol-processing-api:1.8.0-Beta-1.0.8")
    if (!JavaVersion.current().isJava9Compatible()) {
        api files(org.gradle.internal.jvm.Jvm.current().toolsJar)
    }
    kspTest(project)
    kspTest libs.bundles.asm
    testImplementation("com.github.tschuchortdev:kotlin-compile-testing-ksp:1.4.9")
    testImplementation project(":jackson-databind")
    testImplementation libs.kotlin.stdlib
    testImplementation libs.managed.jackson.annotations
    testImplementation libs.managed.validation
    testImplementation libs.managed.reactor
    testImplementation libs.hibernate
    testImplementation project(":validation")
    testImplementation libs.javax.persistence
    testImplementation project(":runtime")
    testImplementation(libs.neo4j.bolt)
}

afterEvaluate {
    sourcesJar {
        from "$projectDir/src/main/kotlin"
    }
}

tasks.withType(org.jetbrains.kotlin.gradle.tasks.KotlinCompile).all {
    kotlinOptions {
        freeCompilerArgs = ['-Xjvm-default=all']
    }
}

tasks.named("compileTestGroovy") {
    classpath += files(tasks.compileTestKotlin)
}

tasks.named("test") {
    classpath += files(tasks.compileTestKotlin)
    testLogging {
        showStandardStreams = true
    }
}

